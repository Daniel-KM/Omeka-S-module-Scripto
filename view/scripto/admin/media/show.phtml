<?php 
$this->headLink()->appendStylesheet($this->assetUrl('vendor/featherlight/featherlight.min.css', 'Scripto'));
$this->headLink()->appendStylesheet($this->assetUrl('css/scripto.css', 'Scripto'));
$this->headScript()->appendFile($this->assetUrl('vendor/jquery-panzoom/jquery.panzoom.min.js', 'Scripto'));
$this->headScript()->appendFile($this->assetUrl('vendor/featherlight/featherlight.min.js', 'Scripto'));
$this->headScript()->appendFile($this->assetUrl('js/media-review.js', 'Scripto'));
$this->headScript()->appendFile($this->assetUrl('js/scripto.js', 'Scripto'));
$this->htmlElement('body')->appendAttribute('class', 'scripto media show');
?>

<?php echo $this->pageTitle($this->translate('Media review'), 1, $this->translate('Scripto'), $media->displayTitle()); ?>

<div id="page-actions">
    <div id="page-action-menu">
        <a href="#" class="expand button" aria-label="<?php echo $this->translate('Expand'); ?>"><?php echo $this->translate('Actions'); ?></a>
        <ul class="collapsible">
            <li><?php echo $this->hyperlink($this->translate('Browse revision history'), $this->url('admin/scripto-media-id', ['action' => 'revision'], true)); ?></li>
        </ul>
        <button type="submit"><?php echo $this->translate('Save'); ?></button>
    </div>
</div>

<?php echo $this->scripto()->adminLoginBar(); ?>

<?php echo $this->scripto()->adminBreadcrumbs(); ?>

<?php
$previous = $sMedia->previousScriptoMedia();
$next = $sMedia->nextScriptoMedia();
?>
<nav class="pagination" role="navigation">
    <?php if ($previous): ?>
    <?php echo $this->hyperlink('', $previous->adminUrl(), ['class' => 'previous o-icon-prev button', 'title' => $this->translate('Previous')]); ?>
    <?php else: ?>
    <span class="previous o-icon-prev button inactive"></span>
    <?php endif; ?>
    <?php if ($next): ?>
    <?php echo $this->hyperlink('', $next->adminUrl(), ['class' => 'next o-icon-next button', 'title' => $this->translate('Next')]); ?>
    <?php else: ?>
    <span class="next o-icon-next button inactive"></span>
    <?php endif; ?>
    <span class="row-count"><?php echo sprintf($this->translate('%s of %s'), $sMedia->position(), $sMedia->scriptoItem()->mediaCount()); ?></span>
</nav>

<?php echo $this->sectionNav([
    'wikitext' => $this->translate('Wikitext'),
    'html' => $this->translate('HTML'),
    'metadata' => $this->translate('Metadata'),
]); ?>

<div id="wikitext" class="active section">
    <div class="wikitext-featherlight horizontal">
        <h3><?php echo $media->displayTitle(); ?></h3>
        <button class="full-screen"><?php echo $this->translate('Go full screen'); ?></button>
        <div class="layout">
            <label><?php echo $this->translate('Layout'); ?></label>
            <button name="horizontal" class="horizontal active" aria-label="<?php echo $this->translate('Horizontal view'); ?>" title="<?php echo $this->translate('Horizontal view'); ?>" disabled></button>
            <button name="vertical" class="vertical" aria-label="<?php echo $this->translate('Vertical view'); ?>" title="<?php echo $this->translate('Vertical view'); ?>"></button>
        </div>
        <div class="wikitext-flex">
            <textarea disabled><?php echo $sMedia->pageWikitext(); ?></textarea>
            <div class="panzoom-container">
                <?php echo $media->render(['link' => null]); ?>
                <div class="zoom-controls">
                    <button class="zoom-in" aria-label="<?php echo $this->translate('Zoom in'); ?>" title="<?php echo $this->translate('Zoom in'); ?>"></button>
                    <button class="zoom-out" aria-label="<?php echo $this->translate('Zoom out'); ?>" title="<?php echo $this->translate('Zoom out'); ?>"></button>
                    <button class="rotate-right" aria-label="<?php echo $this->translate('Rotate right'); ?>" title="<?php echo $this->translate('Rotate right'); ?>"></button>
                    <button class="rotate-left" aria-label="<?php echo $this->translate('Rotate left'); ?>" title="<?php echo $this->translate('Rotate left'); ?>"></button>
                    <button class="reset"><?php echo $this->translate('Reset'); ?></button>
                </div>
            </div>
        </div>
        <script>
        (function($) {
            var $zoomContainer = $('.panzoom-container');
            $('#wikitext .media-render').panzoom({
                $zoomIn: $zoomContainer.find(".zoom-in"),
                $zoomOut: $zoomContainer.find(".zoom-out"),
                $reset: $zoomContainer.find(".reset")
            });
        })(jQuery);
        </script>
    </div>
</div>

<div id="html" class="section">
    <?php echo $sMedia->pageHtml(); ?>
</div>

<div id="metadata" class="section">
    <div class="property">
        <h4><?php echo $this->translate('Media'); ?></h4>
        <div class="value"><?php echo $sMedia->link($media->displayTitle()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Item'); ?></h4>
        <div class="value"><?php echo $sItem->link($item->displayTitle()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Project'); ?></h4>
        <div class="value"><?php echo $project->link($project->title()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Status'); ?></h4>
        <div class="value"><?php echo $this->translate($sMedia->status()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Last synced'); ?></h4>
        <div class="value"><?php echo $this->i18n()->dateFormat($sMedia->synced(), 'long', 'medium'); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Last edited'); ?></h4>
        <?php $edited = $sMedia->edited(); ?>
        <div class="value"><?php echo $edited
            ? sprintf(
                '%s by %s',
                $this->i18n()->dateFormat($sMedia->edited(), 'long', 'medium'),
                $this->hyperlink($sMedia->editedBy(), $this->url('admin/scripto-user-contributions', ['user-id' => $sMedia->editedBy()]))
            ) : $this->translate('Not edited'); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Last completed'); ?></h4>
        <?php $completed = $sMedia->completed(); ?>
        <div class="value"><?php echo $completed
            ? sprintf(
                '%s by %s',
                $this->i18n()->dateFormat($sMedia->completed(), 'long', 'medium'),
                $this->hyperlink($sMedia->completedBy(), $this->url('admin/scripto-user-contributions', ['user-id' => $sMedia->completedBy()]))
            ) : $this->translate('Not completed'); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Last approved'); ?></h4>
        <?php
        $approved = $sMedia->approved();
        $approvedBy = $sMedia->approvedBy();
        ?>
        <div class="value"><?php echo $approved
            ? sprintf(
                '%s by %s',
                $this->i18n()->dateFormat($sMedia->approved(), 'long', 'medium'),
                $approvedBy
                    ? $approvedBy->link($approvedBy->name())
                    : $this->translate('Unknown')
                )
            : $this->translate('Not approved'); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('MediaWiki page'); ?></h4>
        <?php $page = $sMedia->page(); ?>
        <div class="value"><?php echo $this->hyperlink($sMedia->pageTitle(), $page['fullurl']); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Omeka media'); ?></h4>
        <div class="value"><?php echo $media->link($media->displayTitle()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Omeka item'); ?></h4>
        <div class="value"><?php echo $item->link($item->displayTitle()); ?></div>
    </div>
    <div class="property">
        <h4><?php echo $this->translate('Description'); ?></h4>
        <?php $description = $media->displayDescription(); ?>
        <div class="value"><?php echo $description ? $this->escapeHtml($description) : $this->translate('No description'); ?></div>
    </div>
</div>

<div class="sidebar always-open" id="reviewer-form">
    <h3><?php echo $this->translate('Review media'); ?></h3>
    <div class="field">
        <label for="media-approval-status"><?php echo $this->translate('Approval status'); ?></label>
        <input type="checkbox" name="media-approval-status" id="media-approval-status" checked>
        <div class="history">
            <span class="last-approved"><?php echo sprintf($this->translate('Last approved on %s by %s.'), 'Jan 16, 2018', 'jsafley'); ?></span>
            <a href="#" class="sidebar-content" data-sidebar-selector="#approval-history"><?php echo $this->translate('View history'); ?></a>
        </div>
    </div>
    
    <div class="field">
        <label for="media-completion-status"><?php echo $this->translate('Completion status'); ?></label>
        <input type="checkbox" name="media-completion-status" id="media-completion-status" checked>
        <div class="history">
            <span class="last-completed"><?php echo sprintf($this->translate('Marked complete on %s by %s.'), 'Jan 12, 2018', 'knguyen'); ?></span>
            <a href="#" class="sidebar-content" data-sidebar-selector="#completion-history"><?php echo $this->translate('View history'); ?></a>
        </div>
    </div>
    
    <div class="field">
        <label for="media-protected-status"><?php echo $this->translate('Protected?'); ?></label>
        <input type="checkbox" name="media-protected-status" id="media-completion-status" checked>
    </div>
</div>

<div id="approval-history" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Approval history'); ?></h3>
    <table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack">
        <thead>
            <tr>
                <th><?php echo $this->translate('Status'); ?></th>
                <th><?php echo $this->translate('Date'); ?></th>
                <th><?php echo $this->translate('User'); ?></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><?php echo $this->translate('Approved'); ?></td>
                <td><?php echo $this->translate('Jan 13, 2018'); ?></td>
                <td><?php echo $this->translate('jsafley'); ?></td>
            </tr>
            <tr>
                <td><?php echo $this->translate('Not approved'); ?></td>
                <td><?php echo $this->translate('Jan 14, 2018'); ?></td>
                <td><?php echo $this->translate('jsafley'); ?></td>
            </tr>
            <tr>
                <td><?php echo $this->translate('Approved'); ?></td>
                <td><?php echo $this->translate('Jan 16, 2018'); ?></td>
                <td><?php echo $this->translate('jsafley'); ?></td>
            </tr>
        </tbody>
    </table>
</div>

<div id="completion-history" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Completion history'); ?></h3>
    <table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack">
        <thead>
            <tr>
                <th><?php echo $this->translate('Status'); ?></th>
                <th><?php echo $this->translate('Date'); ?></th>
                <th><?php echo $this->translate('User'); ?></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><?php echo $this->translate('Completed'); ?></td>
                <td><?php echo $this->translate('Jan 13, 2018'); ?></td>
                <td><?php echo $this->translate('knguyen'); ?></td>
            </tr>
            <tr>
                <td><?php echo $this->translate('In progress'); ?></td>
                <td><?php echo $this->translate('Jan 14, 2018'); ?></td>
                <td><?php echo $this->translate('jsafley'); ?></td>
            </tr>
            <tr>
                <td><?php echo $this->translate('Completed'); ?></td>
                <td><?php echo $this->translate('Jan 16, 2018'); ?></td>
                <td><?php echo $this->translate('knguyen'); ?></td>
            </tr>
        </tbody>
    </table></div>
